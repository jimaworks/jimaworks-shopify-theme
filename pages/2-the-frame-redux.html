<style>
  /* TODO: de-duplicate */
  .jw-link-button {
    color: white;
    background-color: #0081a3;
    padding: 1rem;
    border-radius: 0.3rem;
    position: relative;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.25);
    cursor: default;
  }
    .jw-link-button:hover,
    .jw-link-button:focus,
    .jw-link-button:active {
      color: white;
      background-color: #006d8a;
    }
    .jw-link-button:active {
      top: 2px;
      left: 2px;
      box-shadow: 0 0 2px rgba(0,0,0,0.25);
    }

  .jw-relationships-tour {
    margin-bottom: 0;
  }
  
  .jw-relationships-tour__actions {
    margin-bottom: .75rem;
  }

  .jw-relationships-tour__content {
    display: flex;
    flex-direction: column-reverse;
    margin-bottom: 3rem;
    margin: 0;
    transition: .125s linear width, .125s linear margin;
    width: 100%;
    max-width: 100%;
  }
    /* .jw-relationships-tour__content.jw-relationships-tour__content--active {} */
    @media only screen and (min-width: 940px) {
      .jw-relationships-tour__content.jw-relationships-tour__content--active {
        flex-direction: row;
        margin: 0 -25%;
        min-width: 90vw;
      }
    }

  .jw-relationships-tour__map {
    flex: 1;
  }

  .jw-relationships-tour__sidebar {
    flex: .5;
    transition: .125s ease height;
    /* height: 0; */
    /* display: none; */
  }
    @media only screen and (min-width: 940px) {
      .jw-relationships-tour__sidebar {
        padding-left: 1rem;
      }
    }

  .jw-relationships-tour__navigation {
    margin-bottom: .75rem;
  }

  .jw-tour {
    /* height: 0; */
    transition: .125s ease height;
    /* overflow: hidden; */
  }
    @media only screen and (min-width: 940px) {
      .jw-tour {
        transition: none;
      }
    }

  .jw-tour__descriptions {
    transition: .125s linear height;
    position: relative;
  }
    .jw-tour__description {
      opacity: 0;
      transition: .125s ease opacity;
      position: absolute;
      top: 0;
    }
    .jw-tour__description.jw-tour__description--active {
      opacity: 1;
      z-index: 999999;
    }

  .--expanded {
    height: 100%;
  }

  .jw-tour__actions {
    position: relative;
    z-index: 9999;
  }

  .jw-tour-spot__dropdown {
    margin-bottom: 0;
  }

  /* .jw-tour__action {} */
  .--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .jw-relationships-tour__enter-exit {
    transition: .125s ease width;
  }
/* /TODO */
</style>
<article class="jw-relationships-tour">
  <!-- <nav class="jw-relationships-tour__actions"></nav> -->
  <div id="relationships-tour-content" class="jw-relationships-tour__content jw-relationships-tour__content--active">
    <div id="map" class="jw-relationships-tour__map"></div>
    <aside id="sidebar" class="jw-relationships-tour__sidebar">
      <!-- <nav class="jw-relationships-tour__navigation">
        <span id="tour-actions" class="jw-tour__actions">
          <a id="previous" class="jw-tour__action --disabled" href="javascript:void(0);">Previous</a>
          <a id="next" class="jw-tour__action" href="javascript:void(0);">Next</a>
        </span>
      </nav> -->
      <div id="tour" class="jw-tour --expanded">
        <div class="jw-tour__descriptions">
          <article
            id="frame-description"
            class="jw-tour__description jw-tour__description--active"
            style="width: 100%;"
          >
            <h3 class="jw-tour-spot__heading">Frame</h3>
            <div class="jw-tour-spot__body">
              <!-- <ul>
                <li>Four different styles to choose from</li>
                <li>Your print is double matted using a bevelled SandStone mat with Chinese Red trimming</li>
                <li>The frame is natural wood</li>
                <li>The glazing is UV-protective acrylic plexiglass</li>
                <li>The plaque inset into the mat. It is gold-colored metal etched to your specifications</li>
              </ul> -->
              <label for="frame-selection">Choose your frame:</label>
              <select
                id="frame-selection"
                class="jw-tour-spot__dropdown"
                name="frameSelection"
              >
                <option data-variant-id="BlackWalnut" value="black-walnut">Black Walnut</option>
                <option data-variant-id="GoldTrim" value="gold-trim">Gold Trim</option>
                <option data-variant-id="LightCherry" value="light-cherry">Light Cherry</option>
                <option data-variant-id="BlackRoped" value="black-roped">Black Roped</option>
              </select>
              <p style="margin-top: 24px; margin-top: 1.5rem;">
                <a class="jw-link-button" href="/products/genericrelationshipsproduct-framed">Continue</a>
              </p>
            </div>
          </article>
        </div>
      </div>
    </aside>
  </div>
</article>

<script>
  function recordFrameChoice( variantId, url, variantAbbreviation ) {
    localStorage.setItem( "Frame", variantId );
    localStorage.setItem( "FrameImg", url );

    if ( variantAbbreviation && variantAbbreviation.length ) {
      localStorage.setItem( "FrameAbbrev", variantAbbreviation ); // Not used AFAICT
    }
  }

  function preloadPreviewImages() {
    console.warn( 'preloadPreviewImages' );

    for ( var key in previewImages ) {
      var currentFrameImage = previewImages[key];
      var link = document.createElement( 'link' );
      link.rel = 'preload';
      link.href = currentFrameImage;
      link.as = 'image';
      document.head.appendChild( link );
    }

    previewImagesLoaded = true;
    $frameSelection.removeEventListener( 'mouseover', preloadPreviewImages );
    $frameSelection.removeEventListener( 'click', preloadPreviewImages );
  }

  function changeFrame( newFrameClassId ) {
    var newFrameClass = ( 'jw-relationships-preview--frame-' + newFrameClassId );

    if ( $preview.className.indexOf( 'jw-relationships-preview--frame-' ) !== -1 ) {
      $preview.className = $preview.className.replace(
        /\bjw-relationships-preview--frame-[^\s]+\b/,
        newFrameClass
      );
    } else {
      $preview.classList.add( newFrameClass );
    }
  }

  function getSelectedOption( $select ) {
    return $select.querySelector( ':checked' );
  }

  function getVariantIdFromOption( $option ) {
    return ( $option.dataset ? $option.dataset.variantId : $option.getAttribute( 'data-variant-id' ) );
  }

  function selectOptionWithVariantId( variantId ) {
    var $option = $frameSelection.querySelector( '[data-variant-id="' + variantId + '"]' );

    if ( $option ) {
      $option.selected = true; 
    }
  }

  var $previewLayoutContainer = document.getElementById( 'map' );
  var $previewTemplate = document.getElementById( 'preview-template' );
  var $frameSelection = document.getElementById('frame-selection');
  var $preview;
  var previewImagesLoaded = false;
  var previewImages = {
    /* Frames */
    "BlackWalnut": "https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Walnut-NoPlaque-NoRuler-72ppi.png",
    "GoldTrim": "https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Gold-NoRuler-72ppi.png",
    "LightCherry": "https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Cherry-NoRuler-72ppi.png",
    "BlackRoped": "https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Black-NoRuler-72ppi.png"
  };
  var defaultFrameVariantId = 'BlackWalnut';
  var defaultFrameClassId = 'black-walnut';
  var savedFrameVariantId = localStorage.getItem( 'Frame' );

  // initializeDefaults();
  $previewLayoutContainer.innerHTML = $previewTemplate.innerHTML;
  $preview = $previewLayoutContainer.querySelector('.jw-relationships-preview');

  window.addEventListener( "DOMContentLoaded", function pickYourFrame__onDomContentLoaded() {
    $frameSelection.addEventListener( 'mouseover', preloadPreviewImages, false );
    $frameSelection.addEventListener( 'click', preloadPreviewImages, false );

    $frameSelection.addEventListener( 'change', function frameSelectionChanged( event ) {
      var newValue = event.target.value;
      // $preview already initialized in surrounding scope

      changeFrame( newValue );

      var $selectedOption = getSelectedOption( event.target );
      var variantId = getVariantIdFromOption( $selectedOption );

      recordFrameChoice( variantId, previewImages[variantId] );
    }, false );

    if ( savedFrameVariantId !== defaultFrameVariantId ) {
      selectOptionWithVariantId( savedFrameVariantId );
    }

    // In case user hits back button and browser remembers selection, update the frame to match
    setTimeout( function alignFrameWithSelection() {
      var $initialSelection = getSelectedOption( $frameSelection );

      if ( $initialSelection && ( $initialSelection.value !== defaultFrameClassId ) ) {
        changeFrame( $initialSelection.value );
      }
    }, 0 );
  } );
</script>