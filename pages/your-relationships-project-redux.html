<header>
  <h2>A RelationShips project tells a story.</h2>
  <p>Each consists of five Text Boxes for you to fill out.<br />
  Six Trip Visuals beautifully stage this bit of your history.</p>
</header>

<article class="jw-relationships-tour">
  <nav class="jw-relationships-tour__actions">
    <button
      id="enter-exit-tour"
      class="jw-relationships-tour__enter-exit"
      data-enter-tour-text="Tour the Customizations"
      data-exit-tour-text="Exit the Tour"
      data-expansion-target="#tour"
      aria-expanded="false"
    >Tour the Customizations</button>
    <a
      href="/pages/textbox0-set-the-stage-in-what-part-of-the-world-did-this-story-start"
      class="jw-skip-to-project"
    >Skip to Project</a>
  </nav>
  <div id="relationships-tour-content" class="jw-relationships-tour__content">
    <div id="map" class="jw-relationships-tour__map"></div>
    <aside id="sidebar" class="jw-relationships-tour__sidebar">
      <nav class="jw-relationships-tour__navigation">
        <span id="tour-actions" class="jw-tour__actions" hidden>
          <a id="previous" class="jw-tour__action --disabled" href="javascript:void(0);">Previous</a>
          <a id="next" class="jw-tour__action" href="javascript:void(0);">Next</a>
        </span><!--/.jw-modal__actions-->
      </nav>
      <div id="tour" class="jw-tour">
        <div class="jw-tour__descriptions">
          <article id="title-text-box-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Title Text Box</h3>
            <div class="jw-tour-spot__body">
              <p>The Title TextBox of your RelationShips® project tells the viewer what this is—e.g., your family name’s establishment in America. We generate the first two lines automatically from your entries—a “What” line and a “When” line. You will be able change the entries to anything you want before completing your order, and we provide a third line if you need it.</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="origins-text-box-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Origins Text Box</h3>
            <div class="jw-tour-spot__body">
              <p>The “Origins Text Box” provides two lines for you to commemorate your relation’s crossing. These are generated automatically from your entries. The first line is generated from your entries to the Country of Origin page. The second is generated from your entries to the Port of Departure page. You may of course change to anything you want before you complete your order.</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="destination-text-box-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Destination Text Box</h3>
            <div class="jw-tour-spot__body">
              <p>The “Destination Text Box” provides two lines for you to commemorate your relation’s landfall in America. These are generated automatically from your entries. The first line is generated from your entries to the Port of Entry page. The second is generated from your entries to the Destination page. You may of course change to anything you want before you complete your order.</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="ship-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Ship</h3>
            <div class="jw-tour-spot__body">
              <p>Your RelationShips® product includes a depiction of exactly the ship of your relation’s crossing, if you know it. If you don’t know it, jimaworks may be able to help you find it, and if there is no image of it jimaworks will render a beautiful facsimile from research. If we cannot determine the ship, jimaworks will research and present options of the most likely ship or kind of ship taken.</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="ship-info-text-box-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Ship Info</h3>
            <div class="jw-tour-spot__body">
              <p>Your RelationShips® product focuses on a specific crossing to America of one of the branches of your family. The TripInfo Text Box presents information that conveys something about the nature of the voyage. The first line is usually generated from information about the physical size of the ship used in the voyage. The second is generated from information about the passengers it carried. You may of course change to anything you want before you complete your order.</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="webPlaqueTextBoxDiv-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Plaque</h3>
            <div class="jw-tour-spot__body">
              <p>Your RelationShips® product includes an inset plaque on which you may list those who cross in this voyage. of exactly the ship of your relation’s crossing, if you know it. We provide eight lines for listing those of your relations making this voyage. You may of use the plaque in many ways (of which the examples provide an incomplete sampling).</p>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="map-background-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Map Background</h3>
            <div class="jw-tour-spot__body">
              <p>The map background for the RelationShips® project is historically-specific map or the time you specify as the time of the crossing you are commemorating. You will be able to chose among five different color schemes for your map background.</p>
              <label for="map-background-selection">Choose your color:</label>
              <select
                id="map-background-selection"
                class="jw-tour-spot__dropdown"
                name="mapBackgroundSelection"
              >
                <option value="paris-sage">Paris Sage</option>
                <option value="empress-teal">Empress Teal</option>
                <option value="palace-rosa">Palace Rosa</option>
                <option value="sea-spray-blue">Sea Spray Blue</option>
                <option value="mayan-glow">Mayan Glow</option>
                <!-- <option>Crema Taupe</option> -->
                <!-- <option>Special Order</option> -->
              </select>
            </div>
          </article><!--/.jw-tour__description-->
          <article id="frame-description" class="jw-tour__description">
            <h3 class="jw-tour-spot__heading">Frame</h3>
            <div class="jw-tour-spot__body">
              <ul>
                <li>Four different styles to choose from</li>
                <li>Your print is double matted using a bevelled SandStone mat with Chinese Red trimming</li>
                <li>The frame is natural wood</li>
                <li>The glazing is UV-protective acrylic plexiglass</li>
                <li>The plaque inset into the mat. It is gold-colored metal etched to your specifications</li>
              </ul>
              <label for="frame-selection">Choose your frame:</label>
              <select
                id="frame-selection"
                class="jw-tour-spot__dropdown"
                name="frameSelection"
              >
                <option value="black-walnut">Black Walnut</option>
                <option value="gold-trim">Gold Trim</option>
                <option value="light-cherry">Light Cherry</option>
                <option value="black-roped">Black Roped</option>
              </select>
            </div>
          </article>
        </div><!--/.jw-tour__descriptions-->
      </div><!--/.jw-modal.jw-tour-->
    </aside><!--/#sidebar-->
  </div><!--/.jw-relationships-tour__content-->
</article>

<div>
  <p>Each of these TextBoxes will already be filled in for you and updated as you add information. The more information you provide, the more "yours" the product will become. And at the end, you can make it *completely* yours by purchasing it of course, but before that, also by further modifying it in any way you chose.</p>
  <p>(This is a lot of information to collect, and you may not be able to find it all. But we pre-fill each element of information with stand-in, general text that you can use, as well as a rich set of
    <a href="https://jimaworks.com/pages/resources">hints and tips</a>
    to guide you on how to show what you do know and what you don’t.)</p>
  <p>(Moreover, your customizations are automatically saved to your web browser, so you can go off and do some additional research before completing your project.)</p>

  <h3>More Info</h3>
  <ul>
    <li>
      <a class="float-left submit-button jw-more-info-link" href="/pages/product-anatomy" id="FeaturesLink">Features</a>
    </li>
    <li>
      <a class="float-left submit-button jw-more-info-link" href="/pages/product-sizes" id="SizeLink">Sizes</a>
    </li>
    <li>
      <a class="float-left submit-button jw-more-info-link" href="/pages/prices" id="PriceLink">Price</a>
    </li>
  </ul>
  <!-- <button onclick="actionOnDone()">Start building your story</button> -->
  <p>
    <a class="jw-link-button" href="/pages/textbox0-set-the-stage-in-what-part-of-the-world-did-this-story-start">Start building your story</a>
  </p>
</div>

<script>
  var currentTourSpotIndex = 0;
  var $tourSpotsCache;
  var tourSpotDescriptionsPreviouslyActivated = false;
  var previewImagesLoaded = false;
  var tourSpotOriginalClasses = {};
  var $previewTemplate = document.getElementById('preview-template');
  var $previewLayoutContainer = document.getElementById('map');
  var $enterExitTourButton = document.getElementById('enter-exit-tour');
  var $tourActions = document.getElementById('tour-actions');
  var $mapBackgroundSelection = document.getElementById('map-background-selection');
  var $frameSelection = document.getElementById('frame-selection');
  var $preview;

  function getTourSpots() {
    if ( $tourSpotsCache ) {
      return $tourSpotsCache;
    }

    $tourSpotsCache = document.querySelectorAll('#map [id]');
    return $tourSpotsCache;
  }

  function registerFirstGenLastName() {
    localStorage.setItem('FirstGenLastName', document.getElementById("lastname").value);
    var TitleLine1 = localStorage.getItem('FirstGenLastName') + ' Atlantic Crossing';
    localStorage.setItem("TitleLine1", TitleLine1);
    document.getElementById("lastname").innerHTML = "FirstGen Name provided = " + localStorage.getItem('FirstGenLastName');
  }

  function preloadPreviewImages() {
    var previewImages = [
      /* Map Backgrounds */
      'https://cdn.shopify.com/s/files/1/1336/0641/files/EuM-Liner-Pari.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/EuM-Liner-Empr.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/EuM-Liner-Pala.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/EuM-Liner-SeaS.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/EuM-Liner-Maya.png',
      
      /* Frames */
      'https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Gold-NoRuler-72ppi.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Cherry-NoRuler-72ppi.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Black-NoRuler-72ppi.png',
      'https://cdn.shopify.com/s/files/1/1336/0641/files/GoldRatio-Med-Walnut-NoPlaque-NoRuler-72ppi.png',
    ];

    for ( var i = 0; i < previewImages.length; i++ ) {
      var currentFrameImage = previewImages[i];
      var link = document.createElement( 'link' );
      link.rel = 'preload';
      link.href = currentFrameImage;
      link.as = 'image';
      document.head.appendChild( link );
    }

    previewImagesLoaded = true;
  }

  function enterTour() {
    var $tourSpots = getTourSpots();
    var $expansionTarget = document.querySelector( $enterExitTourButton.getAttribute('data-expansion-target') );
    var $prevNext = document.getElementById('tour-actions');
    var $sidebar = document.getElementById('sidebar');

    if ( !previewImagesLoaded ) {
      // Prevent flash of unstyled content after changing selection
      preloadPreviewImages();
    }

    // for (var i = 0; i < $tourSpots.length; i++) {
    //   var $tourSpot = $tourSpots[i];
    //   var tourSpotOriginalClass = ( $tourSpot.getAttribute('class') || '' );

    //   tourSpotOriginalClasses[$tourSpot.id] = tourSpotOriginalClass;
    //   // $tourSpot.setAttribute('class', tourSpotOriginalClass + ' jw-info');
    // }
    if ( isMapBackground($tourSpots[currentTourSpotIndex]) ) {
      highlight($tourSpots[currentTourSpotIndex], false, true);
    } else if ( isFrame($tourSpots[currentTourSpotIndex]) ) {
      highlight($tourSpots[currentTourSpotIndex], true, true);
    } else {
      highlight($tourSpots[currentTourSpotIndex]);
    }
    $sidebar.classList.add( 'jw-relationships-tour__sidebar--active' );

    $prevNext.hidden = false;
    $previewLayoutContainer.addEventListener('click', tourActive__onPreviewClick, false);
    $enterExitTourButton.textContent = $enterExitTourButton.getAttribute('data-exit-tour-text');
    $enterExitTourButton.setAttribute('aria-expanded', 'true');
    $expansionTarget.classList.add('--expanded');
    activateTourSpotDescriptions();
  };

  function exitTour() {
    var $tourSpots = getTourSpots();
    var $expansionTarget = document.querySelector( $enterExitTourButton.getAttribute('data-expansion-target') );
    var $prevNext = document.getElementById('tour-actions');
    var $tourContent = document.getElementById('relationships-tour-content');
    var $sidebar = document.getElementById('sidebar');

    $tourContent.style.maxHeight = $tourContent.height + 'px';
    setTimeout(function () {
      $tourContent.style.maxHeight = '';
    }, 1000);

    // for (var i = 0; i < $tourSpots.length; i++) {
    //   var $tourSpot = $tourSpots[i];
    //   $tourSpot.setAttribute('class', tourSpotOriginalClasses[$tourSpot.id]);
    // }
    unhighlight($tourSpots[currentTourSpotIndex]);
    currentTourSpotIndex = 0;
    $prevNext.hidden = true;
    $previewLayoutContainer.removeEventListener('click', tourActive__onPreviewClick, false);
    $enterExitTourButton.textContent = $enterExitTourButton.getAttribute('data-enter-tour-text');
    $enterExitTourButton.setAttribute('aria-expanded', 'false');
    $expansionTarget.classList.remove('--expanded');
    $sidebar.style.height = '0';
    
    if ( matchMedia('only screen and (min-width: 940px)').matches ) {
      $sidebar.style.display = '';
    } else {
      setTimeout(function () {
        $sidebar.style.display = '';
        $sidebar.classList.remove( 'jw-relationships-tour__sidebar--active' );
      }, 125);
    }
    deactivateTourSpotDescriptionss();
  };

  function tourActive__onPreviewClick(event) {
    var $clicked = event.target;
    var id = $clicked.id;

    while ( id === '' ) {
      $clicked = $clicked.parentNode;
      id = $clicked.id;
    }

    switch ( id ) {
      case 'title-text-box':
        describeTitleTextBox();
        break;

      case 'destination-text-box':
        describeDestinationTextBox();
        break;

      case 'origins-text-box':
        describeOriginsTextBox();
        break;

      case 'ship':
        describeShip();
        break;

      case 'ship-info-text-box':
        describeShipInfoTextBox();
        break;
      
      case 'webPlaqueTextBoxDiv':
        describePlaqueTextBox();
        break;
    }
  }

  function deactivateTourSpotDescriptionss() {
    var $tourContent = document.getElementById('relationships-tour-content');
    var $tourSpotDescriptions = document.querySelectorAll( '.jw-tour__description' );
    var $next = document.getElementById('next');
    var $previous = document.getElementById('previous');
    var $sidebar = document.getElementById('sidebar');

    for (var index = 0; index < $tourSpotDescriptions.length; index++) {
      var $tourSpotDescription = $tourSpotDescriptions[index];

      $tourSpotDescription.classList.remove('jw-tour__description--active');
    }

    $next.classList.remove('--disabled');
    $previous.classList.add('--disabled');
    $tourContent.classList.remove('jw-relationships-tour__content--active');
    $sidebar.style.height = '';
  }

  function activateTourSpotDescriptions() {
    // var $tourSpotDescriptions = getTourSpotDescriptions();
    var $tourContent = document.getElementById('relationships-tour-content');
    var $tourSpotDescriptions = document.querySelectorAll( '.jw-tour__description' );
    var $currentHighlight = document.querySelector('.jw-highlighted');
    var $sidebar = document.getElementById('sidebar');
    var $tourActions = document.getElementById('tour-actions');

    for (var index = 0; index < $tourSpotDescriptions.length; index++) {
      var $tourSpotDescription = $tourSpotDescriptions[index];

      $tourSpotDescription.classList.remove('jw-tour__description--active');

      if ( $tourSpotDescription.id.indexOf( $currentHighlight.id + '-description' ) !== -1 ) {
        $tourSpotDescription.classList.add('jw-tour__description--active');
        
        if ( !tourSpotDescriptionsPreviouslyActivated ) {
          // Give styles enough time to apply to the newly un-hidden DOM before adjusting or the description offsetHeight will be too short
          setTimeout(function () {
            $sidebar.style.height = ( $tourSpotDescription.offsetHeight + $tourActions.offsetHeight + 'px' );
            tourSpotDescriptionsPreviouslyActivated = true;
          }, 0);
        } else {
          $sidebar.style.height = ( $tourSpotDescription.offsetHeight + $tourActions.offsetHeight + 'px' );
        }
      }
    }

    $tourContent.classList.add('jw-relationships-tour__content--active');
  }

  function isPlaque( $element ) {
    var className = $element.getAttribute('class');
    
    return ( className && ( className.indexOf('jw-plaque') !== -1 ) );
  }

  function isMapBackground( $element ) {
    var className = $element.getAttribute('class');

    return ( className && ( className.indexOf('jw-map') !== -1 ) );
  }

  function isFrame( $element ) {
    var className = $element.getAttribute('class');

    return ( className && ( className.indexOf('jw-relationships-preview') !== -1 ) );
  }

  function changeMapBackground() {}

  // function tour(descriptions) {}

  initializeDefaults();

  localStorage.setItem('viewingTextBoxes', 'yup');
  localStorage.setItem('viewingTripVisuals', 'yup');

  window.onbeforeunload = function(){
    localStorage.removeItem("viewingTextBoxes");
    localStorage.removeItem("viewingTripVisuals");
  };

  $previewLayoutContainer.innerHTML = $previewTemplate.innerHTML;
  $preview = $previewLayoutContainer.querySelector('.jw-relationships-preview');

  window.addEventListener("DOMContentLoaded", function yourRelationshipsProject__onDomContentLoaded() {
    $enterExitTourButton.addEventListener('click', function enterExitTourButton__onClick() {
      var enterTourText = $enterExitTourButton.getAttribute('data-enter-tour-text');
      var exitTourText = $enterExitTourButton.getAttribute('data-exit-tour-text');
      var currentTourText = $enterExitTourButton.textContent;

      if ( currentTourText === enterTourText ) {
        enterTour();
      } else if ( currentTourText === exitTourText ) {
        exitTour();
      }
    });

    $tourActions.addEventListener('click', function tourActions__onClick(event) {
      var $clicked = event.target;
      var $tourSpots = getTourSpots();
      var $previous = document.getElementById('previous');
      var $next = document.getElementById('next');
      var lastTourSpotIndex = ( $tourSpots.length - 1 );
      var desiredIndex;
      var proceed = false;

      if ( $clicked.id === 'previous' ) {
        desiredIndex = ( currentTourSpotIndex - 1 );

        if ( desiredIndex < 0 ) {
          return false;
        }

        if ( desiredIndex < lastTourSpotIndex ) {
          $next.classList.remove('--disabled');
        }

        if ( desiredIndex === 0 ) {
          $previous.classList.add('--disabled');
        }

        unhighlight($tourSpots[currentTourSpotIndex]);
        currentTourSpotIndex--;

        if ( isPlaque($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], true);
        } else if ( isMapBackground($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], false, true);
        } else if ( isFrame($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], true, true);
        } else {
          highlight($tourSpots[currentTourSpotIndex]);
        }
        
        activateTourSpotDescriptions();
      } else if ( $clicked.id === 'next' ) {
        desiredIndex = ( currentTourSpotIndex + 1 );

        if ( desiredIndex > lastTourSpotIndex ) {
          return false;
        }

        if ( desiredIndex > 0 ) {
          $previous.classList.remove('--disabled');
        }

        if ( desiredIndex === lastTourSpotIndex ) {
          $next.classList.add('--disabled');
        }

        unhighlight($tourSpots[currentTourSpotIndex]);
        currentTourSpotIndex++;

        if ( isPlaque($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], true);
        } else if ( isMapBackground($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], false, true);
        } else if ( isFrame($tourSpots[currentTourSpotIndex]) ) {
          highlight($tourSpots[currentTourSpotIndex], true, true);
        } else {
          highlight($tourSpots[currentTourSpotIndex]);
        }

        activateTourSpotDescriptions();
      }
    });
  
    $mapBackgroundSelection.addEventListener('change', function mapBackgroundSelectionChanged(event) {
      var newValue = event.target.value;
      var newColorClass = ( 'jw-map--color-' + newValue );
      var $mapBackground = document.getElementById('map-background');

      if ( $mapBackground.className.indexOf( 'jw-map--color-' ) !== -1 ) {
        $mapBackground.className = $mapBackground.className.replace(
          /\bjw-map--color-[^\s]+\b/,
          newColorClass
        );
      } else {
        $mapBackground.classList.add( newColorClass );
      }
    });

    $frameSelection.addEventListener('change', function frameSelectionChanged(event) {
      var newValue = event.target.value;
      var newFrameClass = ( 'jw-relationships-preview--frame-' + newValue );
      // $preview already initialized in surrounding scope

      if ( $preview.className.indexOf( 'jw-relationships-preview--frame-' ) !== -1 ) {
        $preview.className = $preview.className.replace(
          /\bjw-relationships-preview--frame-[^\s]+\b/,
          newFrameClass
        );
      } else {
        $preview.classList.add( newFrameClass );
      }
    });
  }); // DOMContentLoaded
</script>